<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:JuegoPRU.ViewModels"
             xmlns:services="clr-namespace:JuegoPRU.Services"
             x:Class="JuegoPRU.Views.CharacterSelectionPage"
             Title="Character Selection">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15" VerticalOptions="FillAndExpand">

            <VerticalStackLayout IsVisible="{Binding IsPlayer1Turn}">
                <Frame BorderColor="#2196F3" CornerRadius="10" Padding="15" HasShadow="True">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="{Binding Source={x:Static services:LocalizationManager.Instance}, Path=Player1NameLabel}" FontAttributes="Bold"/>
                        <Entry Placeholder="{Binding Source={x:Static services:LocalizationManager.Instance}, Path=EnterPlayer1NamePlaceholder}" Text="{Binding Player1Name}"/>
                    </VerticalStackLayout>
                </Frame>
            </VerticalStackLayout>

            <VerticalStackLayout IsVisible="{Binding IsPlayer2Turn}">
                <Frame BorderColor="#2196F3" CornerRadius="10" Padding="15" HasShadow="True">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="{Binding Source={x:Static services:LocalizationManager.Instance}, Path=Player2NameLabel}" FontAttributes="Bold"/>
                        <Entry Placeholder="{Binding Source={x:Static services:LocalizationManager.Instance}, Path=EnterPlayer2NamePlaceholder}" Text="{Binding Player2Name}"/>
                    </VerticalStackLayout>
                </Frame>
            </VerticalStackLayout>

            <Label Text="{Binding InstructionText}"
                   FontSize="20"
                   FontAttributes="Bold"
                   HorizontalTextAlignment="Center"
                   TextColor="#2196F3"/>

            <CollectionView x:Name="RaceList"
                            ItemsSource="{Binding Races}"
                            SelectionMode="Single"
                            SelectedItem="{Binding SelectedRaceInfo, Mode=TwoWay}"
                            HeightRequest="300">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" Span="2" />
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="0" Margin="5" BorderColor="Gray" CornerRadius="12">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:CharacterSelectionViewModel}}, Path=SelectRaceCommand}"
                                                      CommandParameter="{Binding .}" />
                            </Frame.GestureRecognizers>
                            <Grid>
                                <Image Source="{Binding Image}" Aspect="AspectFill" HeightRequest="140"/>
                                <Grid BackgroundColor="#80000000">
                                    <VerticalStackLayout Padding="10" VerticalOptions="End">
                                        <Label Text="{Binding Name}" TextColor="White" FontSize="18" FontAttributes="Bold" />
                                        <Label Text="{Binding Description}" TextColor="White" FontSize="12" LineBreakMode="WordWrap" />
                                    </VerticalStackLayout>
                                </Grid>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Weapon Selection -->
            <Frame BorderColor="#FF9800" CornerRadius="10" Padding="15" HasShadow="True">
                <VerticalStackLayout Spacing="10">
                    <Label Text="{Binding Source={x:Static services:LocalizationManager.Instance}, Path=SelectWeaponLabel}" FontAttributes="Bold"/>
                    <CollectionView x:Name="WeaponList"
                                    ItemsSource="{Binding AvailableWeapons}"
                                    SelectionMode="Single"
                                    SelectedItem="{Binding SelectedWeapon, Mode=TwoWay}"
                                    HeightRequest="250">
                        <CollectionView.ItemsLayout>
                            <GridItemsLayout Orientation="Vertical" Span="2" />
                        </CollectionView.ItemsLayout>
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame Padding="8" Margin="5" BorderColor="Gray" CornerRadius="12">
                                    <Frame.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:CharacterSelectionViewModel}}, Path=SelectWeaponCommand}"
                                                              CommandParameter="{Binding .}" />
                                    </Frame.GestureRecognizers>
                                    <VerticalStackLayout Spacing="6" WidthRequest="150">
                                        <Image Source="{Binding Image}" HeightRequest="90" Aspect="AspectFill"/>
                                        <Label Text="{Binding Name}" FontAttributes="Bold" FontSize="14" />
                                        <Label Text="{Binding Description}" FontSize="12" LineBreakMode="WordWrap" TextColor="#555"/>
                                    </VerticalStackLayout>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>

            <Button Text="{Binding NextButtonText}"
                    Command="{Binding NextCommand}"
                    BackgroundColor="#4CAF50"
                    TextColor="White"
                    FontAttributes="Bold"
                    Padding="10"/>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
